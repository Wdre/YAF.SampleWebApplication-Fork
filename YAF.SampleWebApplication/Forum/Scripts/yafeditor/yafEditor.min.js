var doc,bod,I,StateMaker,yafEditor=function(e,t,i,n,o,s){this.Name=e,this.UrlTitle=t,this.UrlDescription=i,this.UrlImageTitle=n,this.UrlImageDescription=o,this.Description=s,null!=document.getElementById("PostAlbumsListPlaceholder")&&getAlbumImagesData(5,0,!1),document.querySelector(".BBCodeEditor").addEventListener("keydown",function(e){!e.ctrlKey||e.altKey||66!=e.which&&73!=e.which&&85!=e.which&&81!=e.which&&13!=e.which||(66==e.which?wrapSelection(this,"[b]","[/b]"):73==e.which?wrapSelection(this,"[i]","[/i]"):85==e.which?wrapSelection(this,"[u]","[/u]"):81==e.which?wrapSelection(this,"[quote]","[/quote]"):13==e.which&&(null!=document.querySelector('[id*="QuickReply"]')?document.querySelector('[id*="QuickReply"]').click():null!=document.querySelector('[id*="PostReply"]')&&(window.location.href=document.querySelector('[id*="PostReply"]').href)))})};function removeFormat(e){var t,i,n,o,s;e.setSelectionRange&&(t=e.selectionStart,i=e.selectionEnd,o=(n=e.value.substring(t,i)).replace(/\[.*?\]/g,""),s=n.length-o.length,e.value=e.value.replace(n,o),setSelectionRange(e,t,i-s))}function setSelectionRange(e,t,i){e.setSelectionRange?(e.focus(),e.setSelectionRange(t,i)):e.createTextRange&&((e=e.createTextRange()).collapse(!0),e.moveEnd("character",i),e.moveStart("character",t),e.select())}function setCaretToPos(e,t){setSelectionRange(e,t,t)}function replaceSelection(e,t){var i,n;e.setSelectionRange?(i=e.selectionStart,n=e.selectionEnd,e.value=e.value.substring(0,i)+t+e.value.substring(n),i!=n?setSelectionRange(e,i,i+t.length):setCaretToPos(e,i+t.length)):document.selection?(e.focus(),document.selection.createRange().text=t):(e.value+=t,e.focus())}function removeFromSelection(e,t,i){var n,o,s;e.setSelectionRange&&(n=e.selectionStart,o=e.selectionEnd,-1!=(s=e.value.substring(n,o)).indexOf(t))&&-1!=s.indexOf(i)&&(e.value=e.value.substring(0,n)+e.value.substring(n+t.length,o-i.length)+e.value.substring(o),n!=o?setSelectionRange(e,n,o-i.length-t.length):setCaretToPos(e,n+t.length))}function wrapSelection(e,t,i){var n,o;e.setSelectionRange?(n=e.selectionStart,o=e.selectionEnd,e.value=e.value.substring(0,n)+t+e.value.substring(n,o)+i+e.value.substring(o),n!=o?setSelectionRange(e,n,t.length+i.length+o):setCaretToPos(e,n+t.length)):document.selection&&(o=document.selection.createRange().text)?(document.selection.createRange().text=t+o+i,e.focus()):(e.value+=t,e.focus(),e.value+=i),e.dispatchEvent(new Event("change"))}function getCurrentSelection(e){var t;return e.setSelectionRange?e.selectionStart!=e.selectionEnd:!!document.selection&&(t=document.selection.createRange()).parentElement()==e&&""!=t.text}yafEditor.prototype.FormatText=function(e,t){var i,n,o=document.getElementById(this.Name);switch(e){case"bold":wrapSelection(o,"[b]","[/b]");break;case"italic":wrapSelection(o,"[i]","[/i]");break;case"underline":wrapSelection(o,"[u]","[/u]");break;case"highlight":wrapSelection(o,"[h]","[/h]");break;case"code":wrapSelection(o,"[code]","[/code]");break;case"codelang":wrapSelection(o,"[code="+t+"]","[/code]");break;case"img":getCurrentSelection(o)?wrapSelection(o,"[img]","[/img]"):(i=this.Description,n=this.UrlImageDescription,bootbox.prompt({title:this.UrlImageTitle,placeholder:"https://",callback:function(t){null!==t&&""!==t&&bootbox.prompt({title:n,placeholder:i,callback:function(e){replaceSelection(o,""!==e&&null!==e?"[img="+t+"]"+e+"[/img]":"[img]"+t+"[/img]")}})}}));break;case"quote":wrapSelection(o,"[quote]","[/quote]");break;case"justifyleft":wrapSelection(o,"[left]","[/left]");break;case"justifycenter":wrapSelection(o,"[center]","[/center]");break;case"justifyright":wrapSelection(o,"[right]","[/right]");break;case"indent":wrapSelection(o,"[indent]","[/indent]");break;case"outdent":getCurrentSelection(o)&&removeFromSelection(o,"[indent]","[/indent]");break;case"removeFormat":getCurrentSelection(o)&&removeFormat(o);break;case"createlink":var s=this.Description,a=this.UrlDescription;bootbox.prompt({title:this.UrlTitle,placeholder:"https://",callback:function(t){null!==t&&""!==t&&(getCurrentSelection(o)?wrapSelection(o,"[url="+t+"]","[/url]"):bootbox.prompt({title:a,placeholder:s,callback:function(e){replaceSelection(o,""!=e&&null!=e?"[url="+t+"]"+e+"[/url]":"[url]"+t+"[/url]")}}))}});break;case"unorderedlist":wrapSelection(o,"[list][*]","[/list]");break;case"orderedlist":wrapSelection(o,"[list=1][*]","[/list]");break;case"color":wrapSelection(o,"[color="+t+"]","[/color]");break;case"fontsize":wrapSelection(o,"[size="+t+"]","[/size]");break;case"AlbumImgId":replaceSelection(o,"[albumimg]"+t+"[/albumimg]");break;case"attach":replaceSelection(o,"[attach]"+t+"[/attach]");break;case"selectAll":o.select();break;case"cut":getCurrentSelection(o)&&document.execCommand("cut");break;case"copy":getCurrentSelection(o)&&document.execCommand("copy");break;case"paste":navigator.clipboard.readText().then(function(e){o.value+=e});break;default:wrapSelection(o,"["+e+"]","[/"+e+"]")}},addEventListener("load",function(){doc=document,bod=doc.body,I=function(e){return doc.getElementById(e)},StateMaker=function(e){e?(this.initialState=e,this.states=[e]):this.states=[],this.savedStates=[],this.canUndo=this.canRedo=!1,this.undoneStates=[],this.addState=function(e){return this.states.push(e),this.undoneStates=[],this.canUndo=!0,this.canRedo=!1,this},this.undo=function(){var e=this.states.length;return this.initialState?1<e&&(this.undoneStates.push(this.states.pop()),this.canRedo=!0,!(this.states.length<2))||(this.canUndo=!1):0<e?(this.undoneStates.push(this.states.pop()),this.canRedo=!0):this.canUndo=!1,this},this.redo=function(){return 0<this.undoneStates.length&&(this.states.push(this.undoneStates.pop()),this.canUndo=!0,!(this.undoneStates.length<1))||(this.canRedo=!1),this},this.save=function(){return this.savedStates=this.states.slice(),this},this.isSavedState=function(){return JSON.stringify(this.states)===JSON.stringify(this.savedStates)}};var t,e=doc.querySelector(".BBCodeEditor"),i=0,n=0,o=new StateMaker,s=I("undo"),a=I("redo"),r=document.getElementById("editor-Counter"),l=e.maxLength;function c(e){t=e.value.trim(),(i=t.split(/\s+/).length)===n&&o.states.length?o.states[o.states.length-1]=t:(o.addState(t),n=i),e.value.length>l?e.value=e.value.substring(0,l):r.textContent=l-e.value.length}r.textContent=l-e.value.length,e.addEventListener("change",function(e){c(this)}),e.onkeyup=function(){c(this)},s.onclick=function(){o.undo(),t=e.value=(o.states[o.states.length-1]||"").trim(),e.focus(),s.disabled=!o.canUndo,a.disabled=!o.canRedo},a.onclick=function(){o.redo(),t=e.value=(o.states[o.states.length-1]||"").trim(),e.focus(),s.disabled=!o.canUndo,a.disabled=!o.canRedo}});var AutoCloseTags=function(e){this.textarea=e,this.autoClosingTags=["b","i","u","h","code","img","quote","left","center","right","indent","list","color","size","albumimg","attach","youtube","vimeo","instagram","twitter","facebook","googlewidget","spoiler","userlink","googlemaps","hide","group-hide","hide-thanks","hide-reply-thanks","hide-reply","hide-posts","dailymotion","audio"],this.enableAutoCloseTags()};AutoCloseTags.prototype={enableAutoCloseTags:function(){var s=this;this.textarea.addEventListener("keydown",function(t){if("]"===t.key){var i,t=this.selectionStart,n=this.value.substr(0,t),o=this.value.substr(this.selectionEnd,this.value.length);let e;try{e=n.match(/\[([^\]]+)$/)[1].match(/^([a-z1-6]+)/)[1]}catch(e){return}-1!==s.autoClosingTags.indexOf(e)&&(i=`[/${e}]`,this.value=n+i+o,this.selectionStart=this.selectionEnd=t,this.focus())}})}},document.addEventListener("DOMContentLoaded",function(){new AutoCloseTags(document.querySelector(".BBCodeEditor"))}),function(r){"use strict";function l(e,t,i){this.$element=r(e),this.$items=void 0,this.options=r.extend(!0,{},r.fn.suggest.defaults,i,this.$element.data(),this.$element.data("options")),this.key=t,this.isShown=!1,this.query="",this._queryPos=[],this._keyPos=-1,this.$dropdown=r("<div />",{class:"dropdown suggest "+this.options.dropdownClass,html:r("<div />",{class:"dropdown-menu",role:"menu"}),"data-key":this.key}),this.load()}l.prototype={__setListener:function(){return this.$element.on("suggest.show",r.proxy(this.options.onshow,this)).on("suggest.select",r.proxy(this.options.onselect,this)).on("suggest.lookup",r.proxy(this.options.onlookup,this)).on("keyup",r.proxy(this.__keyup,this)),this},__getCaretPos:function(e){var t,i,n,o,s=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"],a=!(null==window.mozInnerScreenX);return t=this.$element.get(0),e=e,(i=document.createElement("div")).id="input-textarea-caret-position-mirror-div",document.body.appendChild(i),n=i.style,o=window.getComputedStyle?getComputedStyle(t):t.currentStyle,n.whiteSpace="pre-wrap","INPUT"!==t.nodeName&&(n.wordWrap="break-word"),n.position="absolute",n.visibility="hidden",r.each(s,function(e,t){n[t]=o[t]}),a?(n.width=parseInt(o.width)-2+"px",t.scrollHeight>parseInt(o.height)&&(n.overflowY="scroll")):n.overflow="hidden",i.textContent=t.value.substring(0,e),"INPUT"===t.nodeName&&(i.textContent=i.textContent.replace(/\s/g,"Â ")),(s=document.createElement("span")).textContent=t.value.substring(e)||".",i.appendChild(s),t={top:s.offsetTop+parseInt(o.borderTopWidth),left:s.offsetLeft+parseInt(o.borderLeftWidth)},document.body.removeChild(i),t},__keyup:function(e){switch(e.keyCode){case 27:return void this.hide();case 13:return!0}if(-1===r.inArray(e.keyCode,[38,40,37,39,17,18,9,16,20,91,93,36,35,45,33,34,144,112,113,114,115,116,117,118,119,120,121,122,123,145,19]))for(var e=this.$element,t=e.val(),i=this.__getSelection(e.get(0)).start,n=i;0<=n;n--){var o=r.trim(t.substring(n-1,n));if(!o&&this.options.respectWhitespace){this.hide();break}var s=""==r.trim(t.substring(n-2,n-1));if(o===this.key&&(s||!this.options.respectWhitespace)){this.query=t.substring(n,i),this._queryPos=[n,i],this._keyPos=n,this.lookup(this.query);break}}},__getVisibleItems:function(){return this.$items?this.$items.not(".d-none"):r()},__build:function(){function t(e){n.hide()}var e=this.$dropdown,n=this;e.on("click","a.dropdown-item",function(e){e.preventDefault(),n.__select(r(this).index()),n.$element.focus()}).on("mouseover","a.dropdown-item",function(e){n.$element.off("blur",t)}).on("mouseout","a.dropdown-item",function(e){n.$element.on("blur",t)}),this.$element.before(e).on("blur",t).on("keydown",function(e){var i;if(n.isShown)switch(e.keyCode){case 13:case 9:return(i=n.__getVisibleItems()).each(function(e){r(this).is(".active")&&n.__select(r(this).index())}),!1;case 40:return(i=n.__getVisibleItems()).last().is(".active")||i.each(function(e){var t=r(this),e=i.eq(e+1);if(t.is(".active"))return e.is(".d-none")||(t.removeClass("active"),e.addClass("active")),!1}),!1;case 38:return(i=n.__getVisibleItems()).first().is(".active")||i.each(function(e){var t=r(this),e=i.eq(e-1);if(t.is(".active"))return e.is(".d-none")||(t.removeClass("active"),e.addClass("active")),!1}),!1}})},__mapItem:function(e){var t={text:"",value:"",class:""};return!(this.options.map&&!(e=this.options.map(e)))&&(e instanceof Object?(t.text=e.text||"",t.value=e.value||"",t.class=e.class||""):(t.text=e,t.value=e),r("<a />",{class:"dropdown-item "+t.class,"data-value":t.value,href:"#",html:t.text}))},__select:function(e){var t=this.options.endKey||"",i=this.$element,n=i.get(0),o=i.val(),e=this.get(e),s=this._keyPos+e.value.length+1;i.val(o.slice(0,this._keyPos)+e.value+t+" "+o.slice(this.__getSelection(n).start)),i.blur(),n.setSelectionRange?n.setSelectionRange(s,s):n.createTextRange&&((t=n.createTextRange()).collapse(!0),t.moveEnd("character",s),t.moveStart("character",s),t.select()),i.trigger(r.extend({type:"suggest.select"},this),e),this.hide()},__getSelection:function(e){return e.focus(),{start:e.selectionStart,end:e.selectionEnd}},__buildItems:function(e){var t=this.$dropdown.find(".dropdown-menu");if(t.empty(),e&&e instanceof Array)for(var i in e){i=this.__mapItem(e[i]);i&&t.append(i)}return t.find("a.dropdown-item")},__lookup:function(e,t){t.eq(0).addClass("active");this.$element.trigger(r.extend({type:"suggest.lookup"},this),[e,t]),t&&t.length?this.show():this.hide()},__filterData:function(i,e){var n=this.options;return this.$items.addClass("d-none"),this.$items.filter(function(e){var t;return""===i?e<n.filter.limit:(e=r(this).text(),t=r(this).data().value,n.filter.casesensitive||(e=e.toLowerCase(),i=i.toLowerCase(),t=t.toLowerCase()),-1!=e.indexOf(i)||-1!=t.indexOf(i))}).slice(0,n.filter.limit).removeClass("d-none active"),this.__getVisibleItems()},get:function(e){var t;if(this.$items)return{text:(t=this.$items.eq(e)).text(),value:t.attr("data-value"),index:e,$element:t}},lookup:function(t){this.options;function e(e){-1!==i._keyPos&&(i.$items||(i.$items=i.__buildItems(e)),i.__lookup(t,i.__filterData(t,e)))}var i=this,n="function"==typeof this.options.data?(this.$items=void 0,this.options.data(t,e)):this.options.data;n&&"function"==typeof n.promise?n.done(e):n&&e.call(this,n)},load:function(){this.__setListener(),this.__build()},hide:function(){this.$dropdown.find(".dropdown-menu").removeClass("show"),this.isShown=!1,this.$items&&this.$items.removeClass("active"),this._keyPos=-1},show:function(){var e,t=this.$element,i=this.$dropdown.find(".dropdown-menu"),n=t.get(0),o=this.options,s={top:"auto",bottom:"auto",left:"auto",right:"auto"};if(!this.isShown){if(i.addClass("show"),!1!==o.position){if(e=this.__getCaretPos(this._keyPos),"string"==typeof o.position)switch(o.position){case"bottom":s.top=t.outerHeight()-parseFloat(i.css("margin-top")),s.left=0,s.right=0;break;case"top":s.top=-(i.outerHeight(!0)+parseFloat(i.css("margin-top"))),s.left=0,s.right=0;break;case"caret":s.top=e.top-n.scrollTop,s.left=e.left-n.scrollLeft}else s=r.extend(s,"function"==typeof o.position?o.position(n,e):o.position);i.css(s)}this.isShown=!0,t.trigger(r.extend({type:"suggest.show"},this))}}};var e=r.fn.suggest;r.fn.suggest=function(t){function o(i,e){var n={};return r.each(e,function(e,t){e=e.toString().charAt(0);n[e]=new l(i,e,"object"==typeof t&&t)}),n}var s=arguments[1],a=arguments[2];return this.each(function(){var e=r(this),i=e.data("suggest"),n={};if("string"==typeof t)if(1==t.length){if(s)if("string"==typeof s){if(t in i&&void 0!==i[t][s])return i[t][s].call(i[t],a);console.error(t+" is not a suggest")}else n[t]=r.isArray(s)||"function"==typeof s?{data:s}:s,i&&t in i?i[t].options=r.extend({},i[t].options,n[t]):i=r.extend(i,o(this,n)),e.data("suggest",i)}else console.error("you're not initializing suggest properly. arg1 should have length == 1");else i?(r.each(t,function(e,t){e in i==!1?n[e]=t:i[e].options=r.extend({},i[e].options,t)}),e.data("suggest",r.extend(i,o(this,n)))):e.data("suggest",o(this,t))})},r.fn.suggest.defaults={data:[],map:void 0,filter:{casesensitive:!1,limit:5},dropdownClass:"",position:"caret",endKey:"",respectWhitespace:!0,onshow:function(e){},onselect:function(e,t){},onlookup:function(e,t){}},r.fn.suggest.Constructor=l,r.fn.suggest.noConflict=function(){return r.fn.suggest=e,this}}(jQuery);